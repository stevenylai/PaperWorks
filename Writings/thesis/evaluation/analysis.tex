\chapter{System Evaluation}
\label{chapter:evaluation}
In this chapter, we analyze the performance of PSWare through analysis, simulation and experiments.

\section{Analysis on TED}
\label{sec:ceduanalysis}
Since TED is the essential algorithm used in our application, our analysis mainly focuses on its energy efficiency and delay. As discussed in our problem formulation, we message cost for measuring the energy efficiency in TED.

\subsection{Analysis on Message Cost}
In order to analyze the efficiency of TED without losing generality, we assume that sensor nodes are randomly deployed in a circular area with radius \(R\). We use distance to approximately measure the number of hops in order to calculate the message cost for event detection. There is no existing work that utilizes event types to detect composite events and it is also very hard to aggregate events without knowing their actual relations. Therefore, as a reference to compare the message cost, we use shortest path tree (SPT) algorithm where events are collected at the sink because their definitions are not considered for event detection.


We use a similar event model that has been introduced in Section \ref{sec:centralized} for analysis. Moreover, since the actual cost of TED will depend on event probabilities. We include such information in our model as well. Suppose we have two event types \(e_1\) and \(e_2\) which are the two sub-event types for a composite event \(e_3\) (i.e. \(e_1re_2=e_3, r\in R\)). The probability for \(e_1\) and \(e_2\) to occur is \(P(e_1)=p_1\) and \(P(e_2)=p_2\) respectively. The probability for \(e_3\) to occur when both \(e_1\) and \(e_2\) have occurred is \(P(e_3|e_1, e_2)=p_3\).

In TED, each node periodically broadcasts its routes to the fusion tables so that others can know how to reach the fusion points. Such cost is similar to many existing routing protocols in WSN such as \cite{rssiroute} where each node periodically broadcasts its route metrics to the sink for the purpose of link quality evaluation. Therefore, in TED, we mainly consider three types of messages which will be used:
\begin{itemize}
\item The overhead for initial event forwarding: \(cost_f\)
\item The overhead for the fusion points to send feedback: \(cost_b\)
\item The message cost for detecting the actual composite events: \(cost_d\)
\end{itemize}

Let the average distance between two random nodes in the square region be \(D\) and the average distance between a node and sink be \(d\). 
\begin{comment}
Then:
\begin{equation*}
D=\frac{2+\sqrt{2}+5\times ln(1+\sqrt{}2)}{15}\times|N|
\end{equation*}
Let the average distance between the event source and the event fusion points be \(d\).
\end{comment}

The cost for initial event forwarding will be: \(cost_f=2\times D\). In order to avoid the extra cost for building up the overlay for each fusion point to communicate with individual sensor nodes, the fusion nodes simply flood the feedback in the network. Therefore, the cost for the fusion points to send feedback will be: \(cost_b=D\times(|N|-2)\). The cost for detecting each individual event is: \(cost_d=D\). The total expected message cost using TED over a time period \(T\) is:
\begin{align*}
&cost_{TED}\\
=&cost_f+cost_b+T(p_1cost_d+p_2cost_d+p_3p_2p_1d)\\
=&D|N|+TD(p_1+p_2)+Tdp_1p_2p_3
\end{align*}

Here \(T\) is the \(expire_n\) used in \(table_e\). The total expected message cost using SPT over a time period \(T\) is:
\begin{equation*}
cost_{SPT}=d\times T(p_1+p_2)
\end{equation*}

To see when TED will cost less than SPT, we have:
\begin{align*}
cost_{TED}&<cost_{SPT}\\
D|N|+TD(p_1+p_2)+Tdp_1p_2p_3&<dT(p_1+p_2)\\
T((p_1+p_2)(d-D)-dp_1p_2p_3))&>|N|
\end{align*}

The inequality can be viewed as a trade-off between message cost saved by TED and the overhead. Simply speaking, TED can reduce message cost when:
\begin{itemize}
\item Fusion points are closer to event source
\item The probability of primitive event is high while the probability of the composite event is lower.
\item Each time after the \(table_e\) is constructed, it used for a relatively long period of \(T\) 
\end{itemize}

\subsection{Analysis on Delay}
In Algorithm \ref{algo:fusionPoint}, if there is no local match, the fusion point will wait for some time to see if there is any other events forwarded from other nodes. In this section, we study the delay of TED.
\begin{theorem}
\label{thm:delay}
Suppose the sensor nodes are randomly deployed in a circular area where sink is located at the center of the network, the events have a time span of \(t\), fusion points are randomly distributed with an average distance to other nodes of \(d\) and the sensor nodes forward the events at the speed of \(v\). Compared with SPT in the worst case, TED will introduce a delay of:
\begin{equation*}
delay_{TED}-delay_{SPT}=\frac{d}{v}+t
\end{equation*}
\end{theorem}

\begin{proof}
Let \(K\) be the average distance from an event to the sink. The delay of SPT will be \(delay_{SPT}=\frac{K}{v}\). To calculate the delay of the worst case in TED, we first need to calculate when TED will eventually forward the event to the sink. According to Algorithm \ref{algo:fusionPoint}, an event fusion point will forward the event if the sink is closer than any other fusion points. Suppose after \(k\) fusion points, the event will be forwarded to the sink. Then, we can get the following.
\begin{align*}
kd&\geq K\\
k&\geq \frac{2}{R}\frac{2}{\pi}\int_0^{\pi}2cos(\frac{\theta}{2})sin(\theta)[\theta-sin(\theta)]d\theta\\
k&\geq \frac{128R}{45\pi}\times\frac{2}{R}\\
k&\geq 1.81
\end{align*}

Therefore, we have:
\begin{align*}
delay_{TED}&=(\frac{d}{v}+t)(k-1)+\frac{D}{v}\\
delay_{TED}-delay_{SPT}&=(\frac{d}{v}+t)(k-1)\\
&=\frac{d}{v}+t
\end{align*}
\end{proof}